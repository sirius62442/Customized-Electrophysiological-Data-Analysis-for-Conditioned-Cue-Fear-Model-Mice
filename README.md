# Customized-Electrophysiological-Data-Analysis-for-Conditioned-Cue-Fear-Model-Mice

1）数据预处理

各种信号均基于TTL事件标记进行时间校准与有效数据段截取，并排除电刺激时段。从原始数据流中提取指定EEG/EMG对应通道信号，经增益校正转换为标准电压单位，EMG信号采用差分处理以提升信噪比。对于RAW格式数据流，执行16倍降采样至1875Hz的标准化处理，并通过时序图进行信号质量评估。LFP信号采用短时傅里叶变换方法进行时频分析，设置2秒窗长和50%重叠率，重点分析0-200Hz频段的神经振荡特征，完整保存各通道的原始信号和时频分析结果。对Spike信号进行300-10000Hz带通滤波、坏通道检测与插值修复，以及共同平均参考去噪。随后应用Kilosort2算法进行Spike排序，设置8σ检测阈值和0.2Hz最小放电率，基于波形特征、ISI违规率和信噪比等指标对排序结果进行质量筛选。

<img width="808" height="755" alt="image" src="https://github.com/user-attachments/assets/658a3057-1907-48e4-a4b3-07070566f1d7" />

图1 Spike Sorting方法效果展示 预处理前的多通道放电波形；(b)预处理后的多通道放电波形；(c)使用Kilosort2进行神经元筛选得到的放电单元示例。

2）睡眠分期判别

参考最近文献1中的方法，本课题基于多模态电生理信号特征分析对睡眠分期进行自动识别，采用三维特征空间对觉醒期（Wake）、非快速眼动睡眠期（NREM）和快速眼动睡眠期（REM）进行分类。
特征提取流程首先对LFP信号进行降维处理，通过主成分分析将多通道LFP信号压缩至单维主成分，并进行最小-最大归一化标准化。关键特征包括LFP主成分值、Theta节律比率和肌电相关性指数。
Theta节律优势度通过计算5-10Hz频段与2-16Hz频段的功率比值进行量化，该指标能够有效反映海马Theta振荡的强度。肌电活动水平则通过计算双侧EMG信号在1秒时间窗内的零滞后相关系数进行评估，该系数与颈部肌肉张力水平高度相关。
睡眠状态判定标准基于以下特征阈值：当LFP主成分值≥0.2且EMG相关系数≤0.9时，判定为NREM睡眠期；当Theta比率≥0.5且EMG相关系数≤0.9时，判定为REM睡眠期；其余时段归类为觉醒期。该方法通过三维特征空间（Theta比率、LFP主成分、EMG相关）实现了睡眠状态的清晰分离，为研究睡眠期间神经活动模式提供了可靠的分期基础。

<img width="961" height="564" alt="image" src="https://github.com/user-attachments/assets/14d72a97-2a52-426e-8ea6-08b40c8cf48f" />

图2 睡眠分期方法与效果示意图 (a) LFP主成分，Theta比率，EMG相关系数不同值的统计分布；(b) 三维特征空间划分结果（蓝色：Wake；橙色：NREM；绿色：REM）；(c) 示例小鼠的睡眠EEG功率谱密度分布（上）与睡眠分期结果（下。黑色：Wake；蓝色：NREM；红色：REM）。

3）LFP与Spike数据的偶联计算

神经元放电活动与局部场电位振荡相位之间的耦合关系通过调制指数进行量化分析。该分析方法基于相位-振幅耦合原理。首先对LFP信号进行多频段带通滤波，涵盖delta（1-4Hz）、theta（4-8Hz）、alpha（8-12Hz）、beta（12-30Hz）、low-gamma（30-50Hz）和high-gamma（50-100Hz）等典型神经振荡频段。采用四阶巴特沃斯零相位滤波器和希尔伯特变换提取各频段LFP信号的瞬时相位，并将相位值归一化至0-360度范围。将每个神经元放电时间戳映射至对应的LFP瞬时相位。对于每个频段和睡眠状态，累计所有神经元的放电相位形成总体相位分布。调制指数计算基于Kullback-Leibler散度度量spike相位分布与均匀分布的偏差程度。调制指数计算公式为：MI = [log(N) - H] / log(N)，其中H为相位分布的香农熵，N为相位分箱数量（默认18个20度宽的分箱）。MI值范围从0到1，0表示spike随机分布于各相位（无耦合），1表示spike完全锁定于特定相位（强耦合）。
